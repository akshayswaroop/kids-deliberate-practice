#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run unit tests first (fast)
echo "ğŸ§ª Running unit tests (Vitest - unit) before commit..."
npm run test:unit
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed! Commit blocked."
  echo "Run 'npm run test:unit' to see failures."
  exit 1
fi

# Now run Playwright E2E (this will start the dev server as configured)
echo "ğŸ› ï¸  Running Playwright E2E tests... (this may take a bit)"
# Use npx to ensure local playwright binary is used
npx playwright test --reporter=list
if [ $? -ne 0 ]; then
  echo "âŒ E2E tests failed! Commit blocked."
  echo "Run 'npx playwright test' to debug failures."
  exit 1
fi

echo "âœ… All tests (unit + e2e) passed! Proceeding with commit."